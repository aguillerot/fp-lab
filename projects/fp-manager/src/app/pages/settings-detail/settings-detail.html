<!-- Back Navigation -->
<nav class="nav">
  <a mat-icon-button routerLink="/" aria-label="Back to home">
    <span class="pi pi-chevron-left"></span>
  </a>
  <span>Settings Details</span>
</nav>

@if (decodedSettings(); as settings) {
<!-- Settings Cards -->
<div class="cards">
  <p-card>
    <ng-template #title>Exposure</ng-template>
    <div class="flex flex-col gap-2">
      <div class="flex items-center justify-between gap-2">
        <span>Shooting Name</span>
        <p-chip [label]="settings.shootingModeName" />
      </div>
      <div class="flex items-center justify-between gap-2">
        <span>Shooting Icon</span>
        <p-chip [label]="settings.shootingModeIcon" />
      </div>
      <div class="flex items-center justify-between gap-2">
        <label for="shootingMode">Shooting Mode</label>
        <p-selectbutton
          id="shootingMode"
          [options]="shootingModeOptions"
          [field]="settingsForm.exposure.shootingMode"
          unselectable
        />
      </div>
      <div class="flex items-center justify-between gap-2">
        <label for="exposureCompensation">Compensation: {{settingsForm.exposure.compensation().value()}}</label>
        <p-slider
          id="exposureCompensation"
          class="min-w-40"
          [min]="-5"
          [max]="5"
          [step]="1"
          [field]="settingsForm.exposure.compensation"
        />
      </div>
      <div class="flex items-center justify-between gap-2">
        <label for="exposureMeteringMode">Metering mode</label>
        <p-select
          id="exposureMeteringMode"
          class="min-w-40"
          [options]="aeMeteringModeOptions"
          [field]="settingsForm.exposure.aeMeteringMode"
        />
      </div>
    </div>
  </p-card>

  <p-card>
    <ng-template #title>ISO</ng-template>
    <div class="flex flex-col gap-2">
      <div class="flex items-center justify-between gap-2">
        <label for="isoSensitivity">Sensitivity</label>
        <p-select
          id="isoSensitivity"
          class="min-w-40"
          [options]="isoSensitivityOptions()"
          [field]="settingsForm.iso.sensitivity"
        />
      </div>
      <div class="flex items-center justify-between gap-2">
        <label for="isoSensitivityStep">Step</label>
        <p-selectbutton
          id="isoSensitivityStep"
          [options]="[{ label: '1/3 EV', value: '1/3 EV'}, { label: '1 EV', value: '1 EV' }]"
          [field]="settingsForm.iso.sensitivityStep"
          unselectable
        />
      </div>
    </div>
    <p-divider />
    <div class="flex flex-col gap-2">
      <div class="flex items-center justify-between gap-2">
        <label for="lowIsoExpansion">Low ISO Expansion</label>
        <p-selectbutton
          id="lowIsoExpansion"
          [options]="[{ label: 'On', value: true}, { label: 'Off', value:false }]"
          [field]="settingsForm.iso.lowExpansion"
          unselectable
        />
      </div>
      <div class="flex items-center justify-between gap-2">
        <label for="highIsoExpansion">High ISO Expansion</label>
        <p-selectbutton
          id="highIsoExpansion"
          [options]="[{ label: 'On', value: true}, { label: 'Off', value:false }]"
          [field]="settingsForm.iso.highExpansion"
          unselectable
        />
      </div>
    </div>
    <p-divider />
    <div class="flex flex-col gap-2">
      <div class="flex items-center justify-between gap-2">
        <label for="autoIsoLowerLimit">Auto Lower Limit</label>
        <p-select
          id="autoIsoLowerLimit"
          class="min-w-40"
          [options]="autoIsoLowerLimitOptions"
          [field]="settingsForm.iso.autoLowerLimit"
        />
      </div>
      <div class="flex items-center justify-between gap-2">
        <label for="autoIsoUpperLimit">Auto Upper Limit</label>
        <p-select
          id="autoIsoUpperLimit"
          class="min-w-40"
          [options]="autoIsoUpperLimitOptions"
          [field]="settingsForm.iso.autoUpperLimit"
        />
      </div>
      <p-inputgroup>
        <p-inputgroup-addon>Shutter Speed Limit</p-inputgroup-addon>
        <p-inputgroup-addon class="flex-1">{{ settings.autoIsoSlowestShutterLimit | shutterSpeed }}</p-inputgroup-addon>
      </p-inputgroup>
    </div>
  </p-card>
  <p-card>
    <ng-template #title>Drive</ng-template>
    <div class="stat-list">
      <div class="stat-item">
        <span class="stat-label">Mode</span>
        <span class="stat-value">{{ settings.driveMode }}</span>
      </div>
      @if (settings.driveMode === 'Interval timer') {
      <div class="stat-item">
        <span class="stat-label">Times</span>
        <span class="stat-value">{{ settings.intervalTimerTimes }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Duration</span>
        <span class="stat-value">{{ settings.intervalTimerDuration | intervalDuration }}</span>
      </div>
      }
    </div>
  </p-card>
  <p-card>
    <ng-template #title>White Balance</ng-template>
    <div class="flex flex-col gap-2">
      <div class="flex items-center justify-between gap-2">
        <label for="whiteBalanceMode">Mode</label>
        <p-select
          id="whiteBalanceMode"
          class="min-w-40"
          [options]="whiteBalanceModeOptions"
          [field]="settingsForm.whiteBalance.mode"
        />
      </div>
      <div class="flex items-center justify-between gap-2">
        <label for="whiteBalanceShiftBA"
          >Shift {{settingsForm.whiteBalance.shiftBA().value() | whiteBalanceShiftBA}}</label
        >
        <p-slider
          id="whiteBalanceShiftBA"
          class="min-w-40"
          [min]="-16"
          [max]="16"
          [step]="2"
          [field]="settingsForm.whiteBalance.shiftBA"
        />
      </div>
      <div class="flex items-center justify-between gap-2">
        <label for="whiteBalanceShiftMG"
          >Shift {{settingsForm.whiteBalance.shiftMG().value() | whiteBalanceShiftMG}}</label
        >
        <p-slider
          id="whiteBalanceShiftMG"
          class="min-w-40"
          [min]="-16"
          [max]="16"
          [step]="2"
          [field]="settingsForm.whiteBalance.shiftMG"
        />
      </div>
    </div>
  </p-card>
</div>

<!-- Action Buttons -->
<div class="submit-container">
  <p-button label="Show QR Code" icon="pi pi-qrcode" severity="secondary" (onClick)="showQrCode()" />
  <p-button label="Save Settings" icon="pi pi-save" (onClick)="onSubmit()" />
</div>

<!-- QR Code Display Dialog -->
<app-qr-display-dialog
  #qrDisplayDialog
  [title]="settings.shootingModeName"
  [qrCodeData]="storedSettings()?.qrCodeData ?? null"
/>
} @else {
<!-- Not Found State -->
<div class="not-found">
  <span class="pi pi-times-circle"></span>
  <h2>Settings not found</h2>
  <p>The settings you are looking for do not exist.</p>
  <a mat-raised-button color="primary" routerLink="/">Go Back Home</a>
</div>
}
