<p-breadcrumb [home]="home" [model]="items" />

@if (decodedSettings(); as settings) {
<!-- Settings Cards -->
<div class="cards">
  <p-card>
    <ng-template #title>Exposure</ng-template>
    <div class="flex flex-col gap-2">
      <div class="flex items-center justify-between gap-2 min-h-8">
        <span>Shooting Name</span>
        <p-chip [label]="settings.shootingModeName" />
      </div>
      <div class="flex items-center justify-between gap-2 min-h-8">
        <span>Shooting Icon</span>
        <p-chip [label]="settings.shootingModeIcon" />
      </div>
      <div class="flex items-center justify-between gap-2 min-h-8">
        <label for="shootingMode">Shooting Mode</label>
        <p-selectbutton
          id="shootingMode"
          [options]="shootingModeOptions"
          [field]="settingsForm.exposure.shootingMode"
          unselectable
        />
      </div>
      <div class="flex items-center justify-between gap-2 min-h-8">
        <span>Shutter Speed</span>
        <i class="pi pi-exclamation-triangle" style="font-size: 1.5rem"></i>
      </div>
      <div class="flex items-center justify-between gap-2 min-h-8">
        <span>Aperture</span>
        <i class="pi pi-exclamation-triangle" style="font-size: 1.5rem"></i>
      </div>
      <div class="flex items-center justify-between gap-2 min-h-8">
        <label for="exposureCompensation">Compensation: {{settingsForm.exposure.compensation().value()}}</label>
        <p-slider
          id="exposureCompensation"
          class="min-w-40"
          [min]="-5"
          [max]="5"
          [step]="1"
          [field]="settingsForm.exposure.compensation"
        />
      </div>
      <div class="flex items-center justify-between gap-2 min-h-8">
        <label for="exposureMeteringMode">Metering mode</label>
        <p-select
          id="exposureMeteringMode"
          class="min-w-40"
          [options]="aeMeteringModeOptions"
          [field]="settingsForm.exposure.aeMeteringMode"
        />
      </div>
    </div>
  </p-card>

  <p-card>
    <ng-template #title>ISO</ng-template>
    <div class="flex flex-col gap-2">
      <div class="flex items-center justify-between gap-2 min-h-8">
        <label for="isoSensitivity">Sensitivity</label>
        <p-select
          id="isoSensitivity"
          class="min-w-40"
          [options]="isoSensitivityOptions()"
          [field]="settingsForm.iso.sensitivity"
        />
      </div>
      <div class="flex items-center justify-between gap-2 min-h-8">
        <label for="isoSensitivityStep">Step</label>
        <p-selectbutton
          id="isoSensitivityStep"
          [options]="[{ label: '1/3 EV', value: '1/3 EV'}, { label: '1 EV', value: '1 EV' }]"
          [field]="settingsForm.iso.sensitivityStep"
          unselectable
        />
      </div>
    </div>
    <p-divider />
    <div class="flex flex-col gap-2">
      <div class="flex items-center justify-between gap-2 min-h-8">
        <label for="lowIsoExpansion">Low ISO Expansion</label>
        <p-selectbutton
          id="lowIsoExpansion"
          [options]="[{ label: 'On', value: true}, { label: 'Off', value:false }]"
          [field]="settingsForm.iso.lowExpansion"
          unselectable
        />
      </div>
      <div class="flex items-center justify-between gap-2 min-h-8">
        <label for="highIsoExpansion">High ISO Expansion</label>
        <p-selectbutton
          id="highIsoExpansion"
          [options]="[{ label: 'On', value: true}, { label: 'Off', value:false }]"
          [field]="settingsForm.iso.highExpansion"
          unselectable
        />
      </div>
    </div>
    <p-divider />
    <div class="flex flex-col gap-2">
      <div class="flex items-center justify-between gap-2 min-h-8">
        <label for="autoIsoLowerLimit">Auto Lower Limit</label>
        <p-select
          id="autoIsoLowerLimit"
          class="min-w-40"
          [options]="autoIsoLowerLimitOptions"
          [field]="settingsForm.iso.autoLowerLimit"
        />
      </div>
      <div class="flex items-center justify-between gap-2 min-h-8">
        <label for="autoIsoUpperLimit">Auto Upper Limit</label>
        <p-select
          id="autoIsoUpperLimit"
          class="min-w-40"
          [options]="autoIsoUpperLimitOptions"
          [field]="settingsForm.iso.autoUpperLimit"
        />
      </div>
      <div class="flex items-center justify-between gap-2 min-h-8">
        <span>Slowest Shutter Speed Limit</span>
        <i class="pi pi-exclamation-triangle" style="font-size: 1.5rem"></i>
      </div>
    </div>
  </p-card>
  <p-card>
    <ng-template #title>Drive</ng-template>
    <div class="flex flex-col gap-2">
      <div class="flex items-center justify-between gap-2 min-h-8">
        <label for="driveMode">Mode</label>
        <p-select id="driveMode" class="min-w-40" [options]="driveModeOptions" [field]="settingsForm.drive.mode" />
      </div>
      @if (settingsForm.drive.mode().value() === 'Interval timer') {
      <div class="flex items-center justify-between gap-2 min-h-8">
        <span>Interval Times</span>
        <span>{{ settingsForm.drive.intervalTimerTimes().value() }}</span>
      </div>
      <div class="flex items-center justify-between gap-2 min-h-8">
        <span>Interval Duration</span>
        <span>{{ settingsForm.drive.intervalTimerDuration().value() }}s</span>
      </div>
      }
    </div>
  </p-card>
  <p-card>
    <ng-template #title>White Balance</ng-template>
    <div class="flex flex-col gap-2">
      <div class="flex items-center justify-between gap-2 min-h-8">
        <label for="whiteBalanceMode">Mode</label>
        <p-select
          id="whiteBalanceMode"
          class="min-w-40"
          [options]="whiteBalanceModeOptions"
          [field]="settingsForm.whiteBalance.mode"
        />
      </div>
      <div class="flex items-center justify-between gap-2 min-h-8">
        <label for="whiteBalanceShiftBA"
          >Shift {{settingsForm.whiteBalance.shiftBA().value() | whiteBalanceShiftBA}}</label
        >
        <p-slider
          id="whiteBalanceShiftBA"
          class="min-w-40"
          [min]="-16"
          [max]="16"
          [step]="2"
          [field]="settingsForm.whiteBalance.shiftBA"
        />
      </div>
      <div class="flex items-center justify-between gap-2 min-h-8">
        <label for="whiteBalanceShiftMG"
          >Shift {{settingsForm.whiteBalance.shiftMG().value() | whiteBalanceShiftMG}}</label
        >
        <p-slider
          id="whiteBalanceShiftMG"
          class="min-w-40"
          [min]="-16"
          [max]="16"
          [step]="2"
          [field]="settingsForm.whiteBalance.shiftMG"
        />
      </div>
    </div>
  </p-card>
</div>

<!-- Action Buttons -->
<div class="submit-container">
  <p-button label="Show QR Code" icon="pi pi-qrcode" severity="secondary" (onClick)="showQrCode()" />
  <p-button label="Save Settings" icon="pi pi-save" (onClick)="onSubmit()" />
</div>

<!-- QR Code Display Dialog -->
<app-qr-display-dialog
  #qrDisplayDialog
  [title]="settings.shootingModeName"
  [qrCodeData]="storedSettings()?.qrCodeData ?? null"
/>
} @else {
<!-- Not Found State -->
<div class="not-found">
  <span class="pi pi-times-circle"></span>
  <h2>Settings not found</h2>
  <p>The settings you are looking for do not exist.</p>
  <a mat-raised-button color="primary" routerLink="/">Go Back Home</a>
</div>
}
