<p-toast />
<lib-scan-dialog [(visible)]="scanDialogVisible" (qrCodeScanned)="handleQrCodeScanned($event)"></lib-scan-dialog>
<app-qr-display-dialog
  #qrDisplayDialog
  [(visible)]="qrDisplayDialogVisible"
  [qrCodeData]="selectedQrCodeData()"
></app-qr-display-dialog>

@if (isEmpty()) {
<!-- Empty State -->
<div class="flex flex-col items-center text-center py-16 px-6">
  <h2>No saved settings</h2>
  <p-button label="Scan QR Code" icon="pi pi-qrcode" (onClick)="openScanDialog()" />
</div>
} @else {
<!-- Settings List -->
<div class="flex justify-between items-center mb-4">
  <h2>Saved Settings</h2>
  <p-button icon="pi pi-qrcode" (onClick)="openScanDialog()" rounded aria-label="Scan QR Code" />
</div>

<p-card>
  <p-table [value]="decodedSettings()" [rowHover]="true" size="small">
    <ng-template pTemplate="body" let-item>
      <tr
        class="cursor-pointer hover:bg-surface-100 dark:hover:bg-surface-800 transition-colors duration-200"
        (click)="openSettings(item)"
        tabindex="0"
        (keydown.enter)="openSettings(item)"
        (keydown.space)="openSettings(item)"
      >
        <td class="w-16 p-3">
          <div
            class="w-10 h-10 rounded-lg flex items-center justify-center font-bold bg-cyan-500/15 text-cyan-500 shrink-0"
          >
            {{ item.decoded.shootingMode }}
          </div>
        </td>
        <td class="p-3">
          <div class="flex flex-col">
            <span class="font-medium text-lg">{{ item.decoded.shootingModeName || 'Untitled Preset' }}</span>
            <span class="text-sm text-surface-500 dark:text-surface-400">
              @if (item.decoded.shootingModeIcon) { {{ item.decoded.shootingModeIcon }} Â· } {{ item.scannedAt | date:
              'MMM d, y' }}
            </span>
          </div>
        </td>
        <td class="w-32 p-3 text-right">
          <div class="flex gap-2 justify-end">
            <p-button
              icon="pi pi-qrcode"
              severity="secondary"
              text
              rounded
              (onClick)="showQrCode($event, item)"
              aria-label="Show QR Code"
            />
            <p-button
              icon="pi pi-copy"
              severity="secondary"
              text
              rounded
              (onClick)="duplicateSettings($event, item)"
              aria-label="Duplicate"
            />
            <p-button
              icon="pi pi-trash"
              severity="danger"
              text
              rounded
              (onClick)="deleteSettings($event, item)"
              aria-label="Delete"
            />
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-card>
}
